---
title: "Week 10 Power Rankings"
author: "John Kane"
date: '2019-11-05'
cover: /images/cover.jpg
slug: week-10-power-rankings
tags: []
categories: []
---



```{r, include = F, echo = F}
## Load Data
library(googlesheets)
library(xml2)
library(httr)
library(curl)
library(shiny)
library(dplyr)
library(reshape2)
library(tidyr)
library(readr)
library(magrittr)
library(stringr)
library(ggplot2)
library(gganimate)
library(tweenr)
library(knitr)
library(ggrepel)

workbook <- gs_url("https://docs.google.com/spreadsheets/d/1c24qtCDF6MnL1I-nNG2ovymFB3fYj1NsWpLe3SGCbJs/pubhtml")

owner <- workbook %>% gs_read(ws = "Owner-Team Name")
games <- workbook %>% gs_read(ws = "Regular Season Games")

owner_games <- left_join(games,owner,by=c("year","team"))
owner_games$week <- as.character(owner_games$week)
owner_games$game <- as.character(owner_games$game)
owner_games$game_id <- as.character(owner_games$game_id)


data <- arrange(owner_games,game_id,points)
data$W <- rep(0,dim(data)[1])
data$L <- rep(0,dim(data)[1])
data$T <- rep(0,dim(data)[1])
data$PA <- rep(0,dim(data)[1])
data$result <- rep(" ",dim(data)[1])
data$opponent <- rep(" ",dim(data)[1])
games_played <- data %>% filter(points > 0)
### Loop to determine winners, and points against
for(i in seq(from=1,to=dim(games_played)[1],by=2)){
  
  games_played$PA[i]   <- games_played$points[i+1]
  games_played$PA[i+1] <- games_played$points[i]
  
  games_played$opponent[i] <- games_played$owner[i+1]
  games_played$opponent[i+1] <- games_played$owner[i]
  
  if(games_played$points[i] < games_played$points[i+1]){
    games_played$L[i] <- 1
    games_played$W[i+1] <- 1
    games_played$result[i] <- "L"
    games_played$result[i+1] <- "W"
    
  }
  if(games_played$points[i] == games_played$points[i+1]){
    games_played$T[i] <- 1
    games_played$T[i+1] <- 1
    games_played$result[i] <- "T"
    games_played$result[i+1] <- "T"
  }
  
}


games_played <- games_played %>%
  arrange(year,week,desc(points)) %>%
  group_by(year,week) %>%
  mutate(rk = rank(points,ties.method="min"),
         opp_rk = rank(PA,ties.method="min")) 

# Now to calculate and add up proportional wins
games_played$pw<- ifelse(games_played$year==2009,(games_played$rk-1)/9,(games_played$rk-1)/11)
games_played$opp_pw <- ifelse(games_played$year==2009,(games_played$opp_rk-1)/9,(games_played$opp_rk-1)/11)
games_played$year_owner <- paste0(games_played$year," ",games_played$owner)
```



## 12. No One Drafts Like Papa (1-8)

Joe D. has struggled his first year in Bad Newz. Should we cut him some slack? What amounts to essentially a 2-QB league could take some time adjusting to if you're not familiar with what it takes.

At the draft he went for $177 on David Johnson and Joe Mixon. Neither of whom are in his starting lineup at the moment. 

So for Joe D's stat let's take a look at how other owners have fared their first year in the league through 9 weeks.

```{r}
owner %>% 
  group_by(owner) %>% 
  filter(year == min(year)) %>%
  select(year,owner) %>%
  inner_join(.,
            games_played %>%
              ungroup() %>%
              filter(year <= 2019 & as.numeric(week) <= 9) %>%
              group_by(owner,year) %>%
              summarise(total_pw = round(sum(pw),1),
                        total_points = sum(points),
                        wins = sum(W)),
            by = c("year","owner")) %>%
  arrange(desc(total_pw)) %>%
  `colnames<-`(c("Year","Owner","Total PW","Total Points", "Wins")) %>%
  kable()
```

Joe D, setting the bar low for new members to Bad Newz since 2019. 

## 11. Loafs 'n Jugs (4-5)

It's hard to imagine any other season where Olson warranted a #11 ranking this late into the season. Olson historically has been consistently good. Maybe Olson is living in the past with Cam Newton and Todd Gurley. He may counter he is looking towards the future starting Dwayne Haskins at OP. 

In what is a down year for Luke, let's reflect on how good he's been historically. 

Playoff Appearance leaderboard

```{r}
owner %>%
  filter(year < 2019) %>%
  group_by(owner) %>%
  summarise(playoffs = sum(playoffs,na.rm=T),seasons = n()) %>%
  arrange(desc(playoffs)) %>%
  `colnames<-`(c("Owner","Playoff Appearances","Seasons")) %>%
  kable()
```



## 10. RJ's Team RJT3

A resurgent Matt Stafford and Ryan "Yes I'm still in the league" Fitzpatrick land RJ at #10. 

RJ has not had much success in Bad News through the years. He leads the league in 24 career low score of the week performances, balanced against only 2 high scoreof the week performances.

But do you know RJ has the single game record for most points in a game? Back in Round 2 of the 2015 playoffs RJ dropped 192.6 points on Hartman. What's more, he's held the single game point record for longer than anyone else to ever hold the record, over 3.5 years!



```{r, echo= F, include = F}

playoff_games <- workbook %>% gs_read(ws = "Playoff Games")
owner_playoff_games <- left_join(playoff_games,owner,by = c("year","team"))

all_games <- bind_rows(owner_games,owner_playoff_games)

all_games %<>%
  mutate(week_txt = ifelse(week == "R1","14",
                       ifelse(week == "R2","15",
                              ifelse(week == "R3","16",week_txt))))
all_games$year_week <- paste0(all_games$year,all_games$week_txt)
all_games$team_year_week <- paste0(all_games$team,"-",all_games$year_week)
all_games$team_points <- paste0(all_games$team," - ",as.character(all_games$points))
all_games %<>% 
  filter(year < 2019 | (year == 2019 & as.numeric(week) <= 9))

f <- function(week_flag){
  output <-
  all_games %>%
    filter(year_week <= as.numeric(week_flag)) %>%
    arrange(desc(points)) %>%
    mutate(rank = row_number(),
           week = week_flag) %>%
     slice(1:10) %>%
    select(rank,year_week,week,team,points,owner,team_year_week,team_points)
  return(output)
}
weekly_top_10 <- lapply(list(unique(all_games$year_week)),function(x) lapply(x,f))
all_top_10 <- do.call(rbind,weekly_top_10[[1]])
year_week_mapping_df <- data.frame(year_week = unique(all_games$year_week)) %>%
  arrange(year_week) %>%
  mutate(obs = row_number())
all_top_10 %<>%
  inner_join(.,year_week_mapping_df, by = c("week" = "year_week"))
all_number1 <- filter(all_top_10,rank==1)
summary <- all_number1 %>%
  group_by(owner,team_year_week,points) %>%
  summarise(weeks_at_no_1 = n(),
            first_week = min(as.numeric(week)),
            last_week = max(as.numeric(week))) %>%
  ungroup() %>%
  arrange(first_week) %>%
  mutate(first_week_char = paste0(str_sub(first_week,1,4)," Week ",str_replace(str_sub(first_week,5,6),'0','')),
         last_week_char = paste0(str_sub(last_week,1,4)," Week ",str_replace(str_sub(last_week,5,6),'0',''))) %>%
  select(1,2,3,4,7,8)
summary2 <- summary
summary2$start <- str_locate(summary$team_year_week,'-')[,1]
summary2$team <- str_sub(summary$team_year_week,1,summary2$start-1)
```

```{r}
summary2 %>%
  select(1,8,3,4,5,6) %>%
  `colnames<-`(c("Owner", "Team", "Points","Weeks with Record","First Week","Last Week")) %>%
  kable()
```


## 9. Tough ACTin TinACTIN

Higdon has been hampered by Drew Brees' injury most of the year.

Higdon's stat: Did You Know that Higdon is the only muliple winner and multiple loser in league history?

```{r}
owner %>%
  filter(year < 2019) %>%
  mutate(title = ifelse(place == 1,1,0),
         last_place = ifelse(year == 2009 & place == 10,1,
                             ifelse(year <= 2018 & place == 12,1,0))) %>%
  group_by(owner) %>%
  summarise(sum_titles = sum(title),
            sum_last = sum(last_place),
            total = sum(title) + sum(last_place)) %>%
  arrange(desc(total)) #%>%
  # `colnames<-`(c("Owner","Year","Luck","Wins")) %>%
```


## 8. Boats and RPOs (3-6)

He's got Dalvin Cook (#2 RB) but he also plays a lot of Sam Darnold and Baker Mayfield

## 7. Urban Fervor (2-7)

It takes a lot of nerve for me to rank myself 7th clocking in at a 2-7 record. But the schedule has cost me 3 wins this year.

How bad can it get? Here's the Unluck Leaderboard through 9 weeks in league history. 

I should be battling for a playoff spot. Instead I'm trying to avoid the 11-12 matchup in the playoffs.

```{r}
games_played %>%
  filter(as.numeric(week) <= 9) %>%
  mutate(Luck = W - pw) %>%
  group_by(owner,year) %>%
  summarise(total_luck = round(sum(Luck),1),
            total_wins = sum(W)) %>%
  arrange(total_luck) %>%
  `colnames<-`(c("Owner","Year","Luck","Wins")) %>%
  kable()
```


## 6. Dinosaur Train

## 5. 3 Blind Mice

## 4. Viking Land Bound

## 3. Anchor Arms

## 2. Whats a ZJ?

Ultimately the Pat's D will need play QBs other than old Big Ben, Josh Rosen, Ryan Fitzpatrick, Luke Falk, Josh Allen, Matt Barkley, Colt Mccoy, Daniel Jones, Sam Darnold, and Baker Mayfield. We saw what happened last week against Lamar Jackson and they put up a pedestrain three points.

Regan is in serious trouble if something happens to Deshaun Watson (Daniel Jones, and Ryan Griffin (Jameis Winston's backup) wait in the wings.) But he rolls with 3 top 17 WR, including #1 Mike Evans. 

This may have gone unappreciated by most, but just a few weeks ago Regan became the first owner in Bad Newz history to eclipse the 15,000 point mark. He remains the only one several weeks later, about 500 points of second place Hartman.

```{r}
owner_games %>%
  filter(as.numeric(week) <= 13) %>%
  group_by(owner) %>%
  summarise(total_points = sum(points)) %>%
  ggplot(data = .,
         aes(x = reorder(owner, total_points),
             y = total_points)) +
  geom_bar(stat="identity") +
  coord_flip() +
  geom_text(aes(x = reorder(owner, total_points),
                y = total_points + 1000,
                label = total_points)) +
  ggtitle("Bad Newz Career Regulaar Season Points Leaderboard",sub = "Through Week 9, 2019")
```

## 1. Joe Buck Yourself