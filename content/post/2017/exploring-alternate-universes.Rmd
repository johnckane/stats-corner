---
title: Exploring Alternate Universes
author: John Kane
date: '2017-12-17'
slug: exploring-alternate-universes
categories:
  - '2017'
  - schedule
tags:
  - '2017'
  - schedule
---

```{r, echo = F, message  = F}
library(googlesheets)
library(xml2)
library(httr)
library(curl)
library(shiny)
library(dplyr)
library(reshape2)
library(tidyr)
library(readr)
library(magrittr)
library(stringr)
library(ggplot2)
library(gganimate)
library(tweenr)
library(knitr)

workbook <- gs_url("https://docs.google.com/spreadsheets/d/1c24qtCDF6MnL1I-nNG2ovymFB3fYj1NsWpLe3SGCbJs/pubhtml")

owner <- workbook %>% gs_read(ws = "Owner-Team Name")
games <- workbook %>% gs_read(ws = "Regular Season Games")

owner_games <- left_join(games,owner,by=c("year","team"))
owner_games$week <- as.character(owner_games$week)
owner_games$game <- as.character(owner_games$game)
owner_games$game_id <- as.character(owner_games$game_id)


data <- arrange(owner_games,game_id,points)
data$W <- rep(0,dim(data)[1])
data$L <- rep(0,dim(data)[1])
data$T <- rep(0,dim(data)[1])
data$PA <- rep(0,dim(data)[1])
data$result <- rep(" ",dim(data)[1])
data$opponent <- rep(" ",dim(data)[1])
games_played <- data %>% filter(points > 0)
### Loop to determine winners, and points against
for(i in seq(from=1,to=dim(games_played)[1],by=2)){
  
  games_played$PA[i]   <- games_played$points[i+1]
  games_played$PA[i+1] <- games_played$points[i]
  
  games_played$opponent[i] <- games_played$owner[i+1]
  games_played$opponent[i+1] <- games_played$owner[i]
  
  if(games_played$points[i] < games_played$points[i+1]){
    games_played$L[i] <- 1
    games_played$W[i+1] <- 1
    games_played$result[i] <- "L"
    games_played$result[i+1] <- "W"
    
  }
  if(games_played$points[i] == games_played$points[i+1]){
    games_played$T[i] <- 1
    games_played$T[i+1] <- 1
    games_played$result[i] <- "T"
    games_played$result[i+1] <- "T"
  }
  
}


games_played <- games_played %>%
  filter(year <= 2017) %>%
  arrange(year,week,desc(points)) %>%
  group_by(year,week) %>%
  mutate(rk = rank(points,ties.method="min"),
         opp_rk = rank(PA,ties.method="min")) 

# Now to calculate and add up proportional wins
games_played$pw<- ifelse(games_played$year==2009,(games_played$rk-1)/9,(games_played$rk-1)/11)
games_played$opp_pw <- ifelse(games_played$year==2009,(games_played$opp_rk-1)/9,(games_played$opp_rk-1)/11)

schedules <- games_played %>% ungroup() %>% mutate(week = as.numeric(week)) %>% select(owner,week,opponent,points,PA,year) %>% arrange(year,owner,week) %>%
  filter(year <= 2017)
schedules$schedule <- schedules$owner

```


```{r, echo = F}
schedules$dummy <- 1

cross_join_games <-  inner_join(schedules %>%
                                 select(owner,week,points,dummy,year),
                               schedules %>%
                                 select(schedule,week,opponent,points,PA,dummy,year),
                               by = c("week","dummy","year")) %>%
  mutate(PA = ifelse(opponent == owner, points.y,PA))


alt_univ <- cross_join_games %>%
  mutate(W = ifelse(points.x > PA,1,0),
         L = ifelse(points.x < PA,1,0),
         Tie = ifelse(points.x == PA,1,0)) %>%
  group_by(owner,year,schedule) %>%
  summarise(wins = sum(W),
            losses = sum(L),
            ties = sum(Tie)) %>%
  mutate(record = ifelse(ties == 0, paste0(wins,"-",losses),
                         paste0(wins,"-",losses,"-",ties)))


```

For the first six or so years in the league we defaulted to however ESPN thought best with the schedule. Back in the message board era of Stats Corner I posted a head to head record matrix that showed that some league members had never played each other. It also showed some people play each other too much or too little, depending on whose side you take in the Regan-Harrington beatdown. By the way, an up to date version of the same matrix is available in the career tab of the  [Record Book](http://ec2-54-213-112-234.us-west-2.compute.amazonaws.com:3838/stats-corner/record-book/).

At the live draft in Florida we went about rectifying the situation so that schedules were more balanced. Every team would play every other team at least once, with each team playing two other teams twice, based on last year's standings. So your schedule is really just one of 12 possible schedules you could have played, all determined by the roll of the dice in an opulent beachfront property near Miami. 

The randomness of the schedule adds to the misery and elation of this game. Everyone can think of an instance where they got screwed by posting the 2nd highest point total only to have the bad luck of playing the team with the highest. Were this a rotisserie you wouldn't have these issues, but rotisseries just aren't as fun. 

The Proportional Wins statistic cuts through some of the noise generated by the random scheduling and the total points leaderboard's sensitivity to outliers. PW rewards consistent strong performances and gives a sense of team performance in a vacuum. That stat would be superior to win/loss record or total points if our league was a one stat rotisserie. This year, based solely on Proportional Wins or total points both Matovina and Thieneman would be in, while Shokunbi and I would be out of the playoffs. .


Over on the [Advanced Standings](http://ec2-54-213-112-234.us-west-2.compute.amazonaws.com:3838/stats-corner/advanced-standings/) page there is a Strength of Schedule statistic. A value of 1 is equivalent to playing the top scoring team in the league every week, whereas a value of 0 is equivalent to playing the lowest scoring team every week. You may look at that table this year and envy the likes of McShane, who played the easiest schedule. On average he had to outscore just 4 teams each week to win (SOS = 0.36 $\approx$ 4/11). Contrast that with D'Skae's schedule, who had to outscore on average 7 teams every week to win (SOS = 0.63 $\approx$ 7/11). What if they had switched schedules? What if you switched schedules with one of them? 

For this exercise I'm going to switch your schedule with every other owner in the league and evaluate your win/loss record. I do not take into account the necessary changes that need to be made to everyone else's schedule to make each of these particular ones work though. So you can get potential win loss records from this but not alternate standings. 

```{r, echo = F}
alt17 <- alt_univ %>% filter(year == 2017)

plot17 <- ggplot(data = alt17,
               aes(x=schedule,y=owner,label=record)) + 
  theme_bw() + 
  geom_text(aes(size=4)) +
  scale_x_discrete("Schedule Played") +
  scale_y_discrete("You", lim=rev(unique(alt17$owner))) +
  theme(legend.position = 'none',panel.grid.minor=element_line(colour='white'),
        axis.text.x=element_text(angle=45,hjust=1,size=12),
        axis.text.y=element_text(size=12)) +
  ggtitle("Records in Alternate Universes", sub = "2017 Season")

print(plot17)
```

That's a lot of data to digest. The reader is free to draw any narrative they wish from that to make them feel better about their season. But to answer the motivating question from above, had D'Skae played McShane's schedule he'd jump from 7-6 to 9-4, whereas had McShane played D'Skae's schedule he'd only have gone 6-7 rather than 9-4.  

In an attempt to summarise that information, here's a table, by owner, of actual wins, then based on schedules, max possible wins and minimum possible wins. 

```{r, echo = F}
actual_records <- alt_univ %>% filter(year == 2017, owner == schedule)
max_records <- alt_univ %>% 
  filter(year == 2017) %>% 
  ungroup() %>% 
  group_by(owner) %>%
  filter(wins == max(wins)) %>%
  mutate(had_you_played_max = ifelse(n() == 1, schedule, paste0(as.character(n())," others"))) %>%
  slice(1)
min_records <- alt_univ %>%
  filter(year == 2017) %>%
  ungroup() %>%
  group_by(owner) %>%
  filter(wins == min(wins)) %>%
  mutate(had_you_played_min = ifelse(n() == 1, schedule, paste0(as.character(n())," others"))) %>%
  slice(1)

all_records <- actual_records %>%
  ungroup() %>%
  left_join(max_records %>% rename(max_wins = wins) %>% select(owner, max_wins, had_you_played_max), by = "owner") %>%
  left_join(min_records %>% rename(min_wins = wins) %>% select(owner, min_wins, had_you_played_min), by = "owner") %>%
  select(owner,wins,max_wins,had_you_played_max,min_wins,had_you_played_min) %>%
  mutate(range = max_wins - min_wins)

kable(all_records %>% select(-range), 
      col.names = c('Owner','Acutal Wins','Max. Possible Wins','Max. Wins Schedule','Min. Possible Wins','Min. Wins Schedule'))
```

What  I see:

* Two owners could have had 11 wins this year, had they played someone else's schedule: Olson playing McShane's or D'Skae playing Regan's. 
* D'Skae's minimum possible wins was 7, a full two wins better than anyone else. 
* Shokunbi made the playoffs despite the possibility of winning only two games had he played Thieneman's schedule.  
* Four owners (Kane, McShane, Shokunbi, Regan) actually played a schedule that maximized their win total. For each owners there were multiple schedules that would have given them their total. Leading the pack there is Regan with 5 schedules that would have maximized his performance of 8 wins. 
* Only D'Skae played the schedule that resulted in the least possible number of wins. And there was only one such schedule. In over half of the possbile schedules he would have had double digit wins. 
* If we define the range for each owner to be the difference between maximum possible wins and minimum possible wins, the average is 4.5 wins. That feels like a huge level of variation in season outcome based on schedule. Easily the difference between making and missing the playoffs. 

## Would be Perfect Seasons

Has it ever happened? Besides back in 2007, [oh wait](https://www.youtube.com/watch?v=CxiHMIM4NWI). 

The league record for total wins was set by Olson back in 2011 with 12, is there a better record lurking somewhere in the multiverse?

```{r, echo = F}
alt_univ %>%
  arrange(desc(wins)) %>%
  filter(wins >= 12) %>%
  select(owner, year, record, schedule) %>%
  kable(.,col.names = c("Owner","Year","Record","Schedule"))
```

Only once! I was expecting anywhere from a handful all the way up to as many as once per year. There were five possible 12 wins seasons out there, Olson being the owner of the only one we've actually seen. 


## [The Darkest Timeline](https://www.youtube.com/watch?v=6RbKaLsxS0o)

On the flip side, was there a schedule out there so brutal some poor team couldn't even win a game? The league record for fewest wins in a season is two, set by Higdon in 2013 and then tied by Ready in 2016.

There were 30 different potential seasons where a team won two or fewer games, so too deep to list here. So below is complete list of all possible seasons finishing with 1 or fewer victories. 

```{r, echo = F}
alt_univ %>%
  arrange(desc(wins)) %>%
  filter(wins <= 1) %>%
  select(owner, year, record, schedule) %>%
  kable(.,col.names = c("Owner","Year","Record","Schedule"))
```

That's it, only Thieneman a few years ago. And it wasn't even a winless season. 

## Other Years

For completeness sake, every year from 2016 back to 2009 are presented here without comment. 

```{r, echo = F}
alt16 <- alt_univ %>% filter(year == 2016)

plot16 <- ggplot(data = alt16,
               aes(x=schedule,y=owner,label=record)) + 
  theme_bw() + 
  geom_text(aes(size=4)) +
  scale_x_discrete("Schedule Played") +
  scale_y_discrete("You", lim=rev(unique(alt16$owner))) +
  theme(legend.position = 'none',panel.grid.minor=element_line(colour='white'),
        axis.text.x=element_text(angle=45,hjust=1,size=12),
        axis.text.y=element_text(size=12)) +
  ggtitle("Records in Alternate Universes", sub = "2016 Season")

print(plot16)
```

```{r, echo = F}
alt15 <- alt_univ %>% filter(year == 2015)

plot15 <- ggplot(data = alt15,
               aes(x=schedule,y=owner,label=record)) + 
  theme_bw() + 
  geom_text(aes(size=4)) +
  scale_x_discrete("Schedule Played") +
  scale_y_discrete("You", lim=rev(unique(alt15$owner))) +
  theme(legend.position = 'none',panel.grid.minor=element_line(colour='white'),
        axis.text.x=element_text(angle=45,hjust=1,size=12),
        axis.text.y=element_text(size=12)) +
  ggtitle("Records in Alternate Universes", sub = "2015 Season")

print(plot15)
```

```{r, echo = F}
alt14 <- alt_univ %>% filter(year == 2014)

plot14 <- ggplot(data = alt14,
               aes(x=schedule,y=owner,label=record)) + 
  theme_bw() + 
  geom_text(aes(size=4)) +
  scale_x_discrete("Schedule Played") +
  scale_y_discrete("You", lim=rev(unique(alt14$owner))) +
  theme(legend.position = 'none',panel.grid.minor=element_line(colour='white'),
        axis.text.x=element_text(angle=45,hjust=1,size=12),
        axis.text.y=element_text(size=12)) +
  ggtitle("Records in Alternate Universes", sub = "2014 Season")

print(plot14)
```

```{r, echo = F}
alt13 <- alt_univ %>% filter(year == 2013)

plot13 <- ggplot(data = alt13,
               aes(x=schedule,y=owner,label=record)) + 
  theme_bw() + 
  geom_text(aes(size=4)) +
  scale_x_discrete("Schedule Played") +
  scale_y_discrete("You", lim=rev(unique(alt13$owner))) +
  theme(legend.position = 'none',panel.grid.minor=element_line(colour='white'),
        axis.text.x=element_text(angle=45,hjust=1,size=12),
        axis.text.y=element_text(size=12)) +
  ggtitle("Records in Alternate Universes", sub = "2013 Season")

print(plot13)
```

```{r, echo = F}
alt12 <- alt_univ %>% filter(year == 2012)

plot12 <- ggplot(data = alt12,
               aes(x=schedule,y=owner,label=record)) + 
  theme_bw() + 
  geom_text(aes(size=4)) +
  scale_x_discrete("Schedule Played") +
  scale_y_discrete("You", lim=rev(unique(alt12$owner))) +
  theme(legend.position = 'none',panel.grid.minor=element_line(colour='white'),
        axis.text.x=element_text(angle=45,hjust=1,size=12),
        axis.text.y=element_text(size=12)) +
  ggtitle("Records in Alternate Universes", sub = "2012 Season")

print(plot12)
```

```{r, echo = F}
alt11 <- alt_univ %>% filter(year == 2011)

plot11 <- ggplot(data = alt11,
               aes(x=schedule,y=owner,label=record)) + 
  theme_bw() + 
  geom_text(aes(size=4)) +
  scale_x_discrete("Schedule Played") +
  scale_y_discrete("You", lim=rev(unique(alt11$owner))) +
  theme(legend.position = 'none',panel.grid.minor=element_line(colour='white'),
        axis.text.x=element_text(angle=45,hjust=1,size=11),
        axis.text.y=element_text(size=11)) +
  ggtitle("Records in Alternate Universes", sub = "2011 Season")

print(plot11)
```

```{r,echo = F}
alt10 <- alt_univ %>% filter(year == 2010)

plot10 <- ggplot(data = alt10,
               aes(x=schedule,y=owner,label=record)) + 
  theme_bw() + 
  geom_text(aes(size=4)) +
  scale_x_discrete("Schedule Played") +
  scale_y_discrete("You", lim=rev(unique(alt10$owner))) +
  theme(legend.position = 'none',panel.grid.minor=element_line(colour='white'),
        axis.text.x=element_text(angle=45,hjust=1,size=10),
        axis.text.y=element_text(size=10)) +
  ggtitle("Records in Alternate Universes", sub = "2010 Season")

print(plot10)
```

```{r, echo=F}
alt09 <- alt_univ %>% filter(year == 2009)

plot09 <- ggplot(data = alt09,
               aes(x=schedule,y=owner,label=record)) + 
  theme_bw() + 
  geom_text(aes(size=4)) +
  scale_x_discrete("Schedule Played") +
  scale_y_discrete("You", lim=rev(unique(alt09$owner))) +
  theme(legend.position = 'none',panel.grid.minor=element_line(colour='white'),
        axis.text.x=element_text(angle=45,hjust=1,size=09),
        axis.text.y=element_text(size=09)) +
  ggtitle("Records in Alternate Universes", sub = "2009 Season")

print(plot09)
```