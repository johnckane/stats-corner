---
title: Exploring Alternate Universes
author: John Kane
date: '2017-12-11'
slug: exploring-alternate-universes
categories:
  - '2017'
  - schedule
tags:
  - '2017'
  - schedule
---

```{r, echo = F}
library(googlesheets)
library(xml2)
library(httr)
library(curl)
library(shiny)
library(dplyr)
library(reshape2)
library(tidyr)
library(readr)
library(magrittr)
library(stringr)
library(ggplot2)
library(gganimate)
library(tweenr)
library(knitr)

workbook <- gs_url("https://docs.google.com/spreadsheets/d/1c24qtCDF6MnL1I-nNG2ovymFB3fYj1NsWpLe3SGCbJs/pubhtml")

owner <- workbook %>% gs_read(ws = "Owner-Team Name")
games <- workbook %>% gs_read(ws = "Regular Season Games")

owner_games <- left_join(games,owner,by=c("year","team"))
owner_games$week <- as.character(owner_games$week)
owner_games$game <- as.character(owner_games$game)
owner_games$game_id <- as.character(owner_games$game_id)


data <- arrange(owner_games,game_id,points)
data$W <- rep(0,dim(data)[1])
data$L <- rep(0,dim(data)[1])
data$T <- rep(0,dim(data)[1])
data$PA <- rep(0,dim(data)[1])
data$result <- rep(" ",dim(data)[1])
data$opponent <- rep(" ",dim(data)[1])
games_played <- data %>% filter(points > 0)
### Loop to determine winners, and points against
for(i in seq(from=1,to=dim(games_played)[1],by=2)){
  
  games_played$PA[i]   <- games_played$points[i+1]
  games_played$PA[i+1] <- games_played$points[i]
  
  games_played$opponent[i] <- games_played$owner[i+1]
  games_played$opponent[i+1] <- games_played$owner[i]
  
  if(games_played$points[i] < games_played$points[i+1]){
    games_played$L[i] <- 1
    games_played$W[i+1] <- 1
    games_played$result[i] <- "L"
    games_played$result[i+1] <- "W"
    
  }
  if(games_played$points[i] == games_played$points[i+1]){
    games_played$T[i] <- 1
    games_played$T[i+1] <- 1
    games_played$result[i] <- "T"
    games_played$result[i+1] <- "T"
  }
  
}


games_played <- games_played %>%
  filter(year <= 2017) %>%
  arrange(year,week,desc(points)) %>%
  group_by(year,week) %>%
  mutate(rk = rank(points,ties.method="min"),
         opp_rk = rank(PA,ties.method="min")) 

# Now to calculate and add up proportional wins
games_played$pw<- ifelse(games_played$year==2009,(games_played$rk-1)/9,(games_played$rk-1)/11)
games_played$opp_pw <- ifelse(games_played$year==2009,(games_played$opp_rk-1)/9,(games_played$opp_rk-1)/11)

schedules <- games_played %>% ungroup() %>% mutate(week = as.numeric(week)) %>% select(owner,week,opponent,points,PA,year) %>% arrange(year,owner,week)
schedules$schedule <- schedules$owner

```


```{r}
schedules$dummy <- 1

cross_join_games <-  inner_join(schedules %>%
                                 select(owner,week,points,dummy,year),
                               schedules %>%
                                 select(schedule,week,opponent,points,PA,dummy,year),
                               by = c("week","dummy","year")) %>%
  mutate(PA = ifelse(opponent == owner, points.y,PA))


alt_univ <- cross_join_games %>%
  mutate(W = ifelse(points.x > PA,1,0),
         L = ifelse(points.x < PA,1,0),
         Tie = ifelse(points.x == PA,1,0)) %>%
  group_by(owner,year,schedule) %>%
  summarise(wins = sum(W),
            losses = sum(L),
            ties = sum(Tie)) %>%
  mutate(record = ifelse(ties == 0, paste0(wins,"-",losses),
                         paste0(wins,"-",losses,"-",ties)))


```


```{r}
alt17 <- alt_univ %>% filter(year == 2017)

plot17 <- ggplot(data = alt17,
               aes(x=schedule,y=owner,label=record)) + 
  theme_bw() + 
  geom_text(aes(size=4)) +
  scale_x_discrete("Hypothetical Schedule Rather Than Yours") +
  scale_y_discrete("You", lim=rev(unique(alt17$owner))) +
  theme(legend.position = 'none',panel.grid.minor=element_line(colour='white'),
        axis.text.x=element_text(angle=45,hjust=1,size=12),
        axis.text.y=element_text(size=12)) +
  ggtitle("Records in Alternate Universes", sub = "2017 Season")

print(plot17)
```


## So Who


```{r}
actual_records <- alt_univ %>% filter(year == 2017, owner == schedule)
max_records <- alt_univ %>% 
  filter(year == 2017) %>% 
  ungroup() %>% 
  group_by(owner) %>%
  filter(wins == max(wins)) %>%
  mutate(had_you_played_max = ifelse(n() == 1, schedule, paste0(as.character(n())," others"))) %>%
  slice(1)
min_records <- alt_univ %>%
  filter(year == 2017) %>%
  ungroup() %>%
  group_by(owner) %>%
  filter(wins == min(wins)) %>%
  mutate(had_you_played_min = ifelse(n() == 1, schedule, paste0(as.character(n())," others"))) %>%
  slice(1)

all_records <- actual_records %>%
  ungroup() %>%
  left_join(max_records %>% rename(max_wins = wins) %>% select(owner, max_wins, had_you_played_max), by = "owner") %>%
  left_join(min_records %>% rename(min_wins = wins) %>% select(owner, min_wins, had_you_played_min), by = "owner") %>%
  select(owner,wins,max_wins,had_you_played_max,min_wins,had_you_played_min)

```


Proportional Wins gives a sense of team performance in a vacuum, it's nearer a rotiserrie scoring than head to head. I like it because it is superior to wins and losses and presents a better measure of consistency than points alone.

But our league isn't rotiserrie. If we went by Proportional Wins or total points then both Matovina and Thieneman are in the playoffs and Shokunbi and I are out. As a digression, the league leader in points has always also led the league in Proportional Wins. Not so with second place. This year RJ was #2 in Proportional Wins (7.5) but sixth in points. No other runner-up in Proportional Wins has ever finished lower than third in total points. Add that to another peculuarity that belongs to RJ's teams (along with concurrently holding most points in a game and fewest points in game).

But I digress.

Everyone has to play some schedule. For the first 6 or so years in the league we defaulted to however ESPN thought best with the schedule. Back in the message board era of Stats Corner, I posted a head to head record matrix which is currently up to date and available in the career tab of the  [Record Book](http://ec2-54-213-112-234.us-west-2.compute.amazonaws.com:3838/stats-corner/record-book/), that showed that some league members had never played each other. It also showed some people play each other too much or too little, depending on whose side you take in the Regan-Harrington beatdown. 

At the live draft in Florida we went about rectifying the situation so that schedules were more balanced. Every team would play every other team at least once, with each team playing two other teams twice, based on last years' standings. So the schedules are still pretty random. 

So where this is all headed to is, what if you played someone else's schedule? How might your season be different?

Constructing a schedule that works is quite a challenge in linear optimization, so what I'm not doing is looking at all possible schedules to evaluate each of them. I'm going to evaluate your record as if you had played the schedule of each other player. 

So you'll have 11 different possible records, all determined I suppose by what division you're in? I'm not exactly sure.



## 2017 


```{r}

```



## Would be Perfect Seasons

Has it ever happened? The league record for total wins was set by Olson back in 2011 with 12. 

```{r}
alt_univ %>%
  arrange(desc(wins)) %>%
  filter(wins >= 12) %>%
  select(owner, year, record, schedule)
```

Only once! I was expecting anywhere from a handful all the way up to as many as once per year.





## The Darkest Timeline ((Link))

On the flip side, was there a schedule out there so brutal some poor team couldn't even win a game? The league record for fewest wins in a season is two, set by Higdon in 2013 and then tied by Ready in 2016.

The list for most wins, filtering on at least the record of 12 was only 6 deep. Not so for fewest wins. There were 30 different potential seasons where a team won two or fewer games. But does there exist a season with zero wins?

```{r}
alt_univ %>%
  arrange(desc(wins)) %>%
  filter(wins <= 1) %>%
  select(owner, year, record, schedule)
```

Nope, turns out to go winless is really really hard.

## Other Years

For completeness sake, every year from 2016 back to 2009 are presented here without comment. 

```{r}
alt16 <- alt_univ %>% filter(year == 2016)

plot16 <- ggplot(data = alt16,
               aes(x=schedule,y=owner,label=record)) + 
  theme_bw() + 
  geom_text(aes(size=4)) +
  scale_x_discrete("Hypothetical Schedule Rather Than Yours") +
  scale_y_discrete("You", lim=rev(unique(alt16$owner))) +
  theme(legend.position = 'none',panel.grid.minor=element_line(colour='white'),
        axis.text.x=element_text(angle=45,hjust=1,size=12),
        axis.text.y=element_text(size=12)) +
  ggtitle("Records in Alternate Universes", sub = "2016 Season")

print(plot16)
```

```{r}
alt15 <- alt_univ %>% filter(year == 2015)

plot15 <- ggplot(data = alt15,
               aes(x=schedule,y=owner,label=record)) + 
  theme_bw() + 
  geom_text(aes(size=4)) +
  scale_x_discrete("Hypothetical Schedule Rather Than Yours") +
  scale_y_discrete("You", lim=rev(unique(alt15$owner))) +
  theme(legend.position = 'none',panel.grid.minor=element_line(colour='white'),
        axis.text.x=element_text(angle=45,hjust=1,size=12),
        axis.text.y=element_text(size=12)) +
  ggtitle("Records in Alternate Universes", sub = "2015 Season")

print(plot15)
```

```{r}
alt14 <- alt_univ %>% filter(year == 2014)

plot14 <- ggplot(data = alt14,
               aes(x=schedule,y=owner,label=record)) + 
  theme_bw() + 
  geom_text(aes(size=4)) +
  scale_x_discrete("Hypothetical Schedule Rather Than Yours") +
  scale_y_discrete("You", lim=rev(unique(alt14$owner))) +
  theme(legend.position = 'none',panel.grid.minor=element_line(colour='white'),
        axis.text.x=element_text(angle=45,hjust=1,size=12),
        axis.text.y=element_text(size=12)) +
  ggtitle("Records in Alternate Universes", sub = "2014 Season")

print(plot14)
```

```{r}
alt13 <- alt_univ %>% filter(year == 2013)

plot13 <- ggplot(data = alt13,
               aes(x=schedule,y=owner,label=record)) + 
  theme_bw() + 
  geom_text(aes(size=4)) +
  scale_x_discrete("Hypothetical Schedule Rather Than Yours") +
  scale_y_discrete("You", lim=rev(unique(alt13$owner))) +
  theme(legend.position = 'none',panel.grid.minor=element_line(colour='white'),
        axis.text.x=element_text(angle=45,hjust=1,size=12),
        axis.text.y=element_text(size=12)) +
  ggtitle("Records in Alternate Universes", sub = "2013 Season")

print(plot13)
```

```{r}
alt12 <- alt_univ %>% filter(year == 2012)

plot12 <- ggplot(data = alt12,
               aes(x=schedule,y=owner,label=record)) + 
  theme_bw() + 
  geom_text(aes(size=4)) +
  scale_x_discrete("Hypothetical Schedule Rather Than Yours") +
  scale_y_discrete("You", lim=rev(unique(alt12$owner))) +
  theme(legend.position = 'none',panel.grid.minor=element_line(colour='white'),
        axis.text.x=element_text(angle=45,hjust=1,size=12),
        axis.text.y=element_text(size=12)) +
  ggtitle("Records in Alternate Universes", sub = "2012 Season")

print(plot12)
```

```{r}
alt11 <- alt_univ %>% filter(year == 2011)

plot11 <- ggplot(data = alt11,
               aes(x=schedule,y=owner,label=record)) + 
  theme_bw() + 
  geom_text(aes(size=4)) +
  scale_x_discrete("Hypothetical Schedule Rather Than Yours") +
  scale_y_discrete("You", lim=rev(unique(alt11$owner))) +
  theme(legend.position = 'none',panel.grid.minor=element_line(colour='white'),
        axis.text.x=element_text(angle=45,hjust=1,size=11),
        axis.text.y=element_text(size=11)) +
  ggtitle("Records in Alternate Universes", sub = "2011 Season")

print(plot11)
```

```{r}
alt10 <- alt_univ %>% filter(year == 2010)

plot10 <- ggplot(data = alt10,
               aes(x=schedule,y=owner,label=record)) + 
  theme_bw() + 
  geom_text(aes(size=4)) +
  scale_x_discrete("Hypothetical Schedule Rather Than Yours") +
  scale_y_discrete("You", lim=rev(unique(alt10$owner))) +
  theme(legend.position = 'none',panel.grid.minor=element_line(colour='white'),
        axis.text.x=element_text(angle=45,hjust=1,size=10),
        axis.text.y=element_text(size=10)) +
  ggtitle("Records in Alternate Universes", sub = "2010 Season")

print(plot10)
```

```{r}
alt09 <- alt_univ %>% filter(year == 2009)

plot09 <- ggplot(data = alt09,
               aes(x=schedule,y=owner,label=record)) + 
  theme_bw() + 
  geom_text(aes(size=4)) +
  scale_x_discrete("Hypothetical Schedule Rather Than Yours") +
  scale_y_discrete("You", lim=rev(unique(alt09$owner))) +
  theme(legend.position = 'none',panel.grid.minor=element_line(colour='white'),
        axis.text.x=element_text(angle=45,hjust=1,size=09),
        axis.text.y=element_text(size=09)) +
  ggtitle("Records in Alternate Universes", sub = "2009 Season")

print(plot09)
```