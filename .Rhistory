schedules$dummy <- 1
cross_join_games <- inner_join(schedules %>%
select(owner,week,points,dummy),
schedules %>%
select(schedule,week,opponent,points,PA,dummy),
by = c("week","dummy")) %>%
mutate(PA = ifelse(opponent == owner, points.y,PA))
cross_join_games
alternate17 <- cross_join_games %>%
mutate(W = ifelse(points.x > PA,1,0),
L = ifelse(points.x < PA,1,0),
Tie = ifelse(points.x == PA,1,0)) %>%
group_by(owner,schedule) %>%
summarise(wins = sum(W),
losses = sum(L),
ties = sum(Tie))
View(alternate17)
schedules_all <- games_played %>% ungroup() %>% mutate(week = as.numeric(week)) %>% select(owner,week,opponent,points,PA) %>% arrange(owner,week)
cross_join_all <- inner_join(schedules_all %>%
select(owner,week,points,dummy),
schedules %>%
select(schedule,week,opponent,points,PA,dummy),
by = c("week","dummy")) %>%
mutate(PA = ifelse(opponent == owner, points.y,PA))
schedules_all$dummy <- 1
cross_join_all <- inner_join(schedules_all %>%
select(owner,week,points,dummy),
schedules %>%
select(schedule,week,opponent,points,PA,dummy),
by = c("week","dummy")) %>%
mutate(PA = ifelse(opponent == owner, points.y,PA))
alternateall <- cross_join_all %>%
mutate(W = ifelse(points.x > PA,1,0),
L = ifelse(points.x < PA,1,0),
Tie = ifelse(points.x == PA,1,0)) %>%
group_by(owner,schedule) %>%
summarise(wins = sum(W),
losses = sum(L),
ties = sum(Tie))
View(alternateall)
alternateall <- cross_join_all %>%
mutate(W = ifelse(points.x > PA,1,0),
L = ifelse(points.x < PA,1,0),
Tie = ifelse(points.x == PA,1,0)) %>%
group_by(owner,year,schedule) %>%
summarise(wins = sum(W),
losses = sum(L),
ties = sum(Tie))
cross_join_all <- inner_join(schedules_all %>%
select(owner,week,points,dummy,year),
schedules %>%
select(schedule,week,opponent,points,PA,dummy,year),
by = c("week","dummy","year")) %>%
mutate(PA = ifelse(opponent == owner, points.y,PA))
schedules_all <- games_played %>% ungroup() %>% mutate(week = as.numeric(week)) %>% select(owner,week,opponent,points,PA,year) %>% arrange(owner,week)
schedules_all$dummy <- 1
cross_join_all <- inner_join(schedules_all %>%
select(owner,week,points,dummy,year),
schedules %>%
select(schedule,week,opponent,points,PA,dummy,year),
by = c("week","dummy","year")) %>%
mutate(PA = ifelse(opponent == owner, points.y,PA))
schedules_all$dummy <- 1
cross_join_all <- inner_join(schedules_all %>%
select(owner,week,points,dummy,year),
schedules_all %>%
select(schedule,week,opponent,points,PA,dummy,year),
by = c("week","dummy","year")) %>%
mutate(PA = ifelse(opponent == owner, points.y,PA))
schedules_all$schedule <- schedules_all$owner
schedules_all$dummy <- 1
cross_join_all <- inner_join(schedules_all %>%
select(owner,week,points,dummy,year),
schedules_all %>%
select(schedule,week,opponent,points,PA,dummy,year),
by = c("week","dummy","year")) %>%
mutate(PA = ifelse(opponent == owner, points.y,PA))
alternateall <- cross_join_all %>%
mutate(W = ifelse(points.x > PA,1,0),
L = ifelse(points.x < PA,1,0),
Tie = ifelse(points.x == PA,1,0)) %>%
group_by(owner,year,schedule) %>%
summarise(wins = sum(W),
losses = sum(L),
ties = sum(Tie))
View(alternateall)
1252/144
alternate_all %>% filter(owner == 'Kane') %>% arrange(desc(wins))
alternateall %>% filter(owner == 'Kane') %>% arrange(desc(wins))
library(googlesheets)
library(xml2)
library(httr)
library(curl)
library(shiny)
library(dplyr)
library(reshape2)
library(tidyr)
library(readr)
library(magrittr)
library(stringr)
library(ggplot2)
library(gganimate)
library(tweenr)
library(knitr)
workbook <- gs_url("https://docs.google.com/spreadsheets/d/1c24qtCDF6MnL1I-nNG2ovymFB3fYj1NsWpLe3SGCbJs/pubhtml")
owner <- workbook %>% gs_read(ws = "Owner-Team Name")
games <- workbook %>% gs_read(ws = "Regular Season Games")
owner_games <- left_join(games,owner,by=c("year","team"))
owner_games$week <- as.character(owner_games$week)
owner_games$game <- as.character(owner_games$game)
owner_games$game_id <- as.character(owner_games$game_id)
data <- arrange(owner_games,game_id,points)
data$W <- rep(0,dim(data)[1])
data$L <- rep(0,dim(data)[1])
data$T <- rep(0,dim(data)[1])
data$PA <- rep(0,dim(data)[1])
data$result <- rep(" ",dim(data)[1])
data$opponent <- rep(" ",dim(data)[1])
games_played <- data %>% filter(points > 0)
### Loop to determine winners, and points against
for(i in seq(from=1,to=dim(games_played)[1],by=2)){
games_played$PA[i]   <- games_played$points[i+1]
games_played$PA[i+1] <- games_played$points[i]
games_played$opponent[i] <- games_played$owner[i+1]
games_played$opponent[i+1] <- games_played$owner[i]
if(games_played$points[i] < games_played$points[i+1]){
games_played$L[i] <- 1
games_played$W[i+1] <- 1
games_played$result[i] <- "L"
games_played$result[i+1] <- "W"
}
if(games_played$points[i] == games_played$points[i+1]){
games_played$T[i] <- 1
games_played$T[i+1] <- 1
games_played$result[i] <- "T"
games_played$result[i+1] <- "T"
}
}
games_played <- games_played %>%
filter(year <= 2017) %>%
arrange(year,week,desc(points)) %>%
group_by(year,week) %>%
mutate(rk = rank(points,ties.method="min"),
opp_rk = rank(PA,ties.method="min"))
# Now to calculate and add up proportional wins
games_played$pw<- ifelse(games_played$year==2009,(games_played$rk-1)/9,(games_played$rk-1)/11)
games_played$opp_pw <- ifelse(games_played$year==2009,(games_played$opp_rk-1)/9,(games_played$opp_rk-1)/11)
season2017 <- games_played %>% filter(year == 2017)
schedules <- season2017 %>% ungroup() %>% mutate(week = as.numeric(week)) %>% select(owner,week,opponent,points,PA) %>% arrange(owner,week)
schedules_all <- games_played %>% ungroup() %>% mutate(week = as.numeric(week)) %>% select(owner,week,opponent,points,PA,year) %>% arrange(owner,week)
schedules_all$schedule <- schedules_all$owner
schedules$schedule <- schedules$owner
head(schedules)
schedules <- games_played %>% ungroup() %>% mutate(week = as.numeric(week)) %>% select(owner,week,opponent,points,PA) %>% arrange(owner,week)
schedules$schedule <- schedules$owner
schedules$dummy <- 1
schedules$dummy <- 1
cross_join_games <-  inner_join(schedules %>%
select(owner,week,points,dummy,year),
schedules %>%
select(schedule,week,opponent,points,PA,dummy,year),
by = c("week","dummy","year")) %>%
mutate(PA = ifelse(opponent == owner, points.y,PA))
schedules <- games_played %>% ungroup() %>% mutate(week = as.numeric(week)) %>% select(owner,week,opponent,points,PA,year) %>% arrange(year,owner,week)
schedules$schedule <- schedules$owner
schedules$dummy <- 1
cross_join_games <-  inner_join(schedules %>%
select(owner,week,points,dummy,year),
schedules %>%
select(schedule,week,opponent,points,PA,dummy,year),
by = c("week","dummy","year")) %>%
mutate(PA = ifelse(opponent == owner, points.y,PA))
alternateall <- cross_join_all %>%
mutate(W = ifelse(points.x > PA,1,0),
L = ifelse(points.x < PA,1,0),
Tie = ifelse(points.x == PA,1,0)) %>%
group_by(owner,year,schedule) %>%
summarise(wins = sum(W),
losses = sum(L),
ties = sum(Tie))
alternateall <- cross_join_games %>%
mutate(W = ifelse(points.x > PA,1,0),
L = ifelse(points.x < PA,1,0),
Tie = ifelse(points.x == PA,1,0)) %>%
group_by(owner,year,schedule) %>%
summarise(wins = sum(W),
losses = sum(L),
ties = sum(Tie))
alt_univ <- cross_join_games %>%
mutate(W = ifelse(points.x > PA,1,0),
L = ifelse(points.x < PA,1,0),
Tie = ifelse(points.x == PA,1,0)) %>%
group_by(owner,year,schedule) %>%
summarise(wins = sum(W),
losses = sum(L),
ties = sum(Tie))
# make the plot
plot_data <- alt_univ
View(alt_univ)
?spread
alternateall <- cross_join_all %>%
mutate(W = ifelse(points.x > PA,1,0),
L = ifelse(points.x < PA,1,0),
Tie = ifelse(points.x == PA,1,0)) %>%
group_by(owner,year,schedule) %>%
summarise(wins = sum(W),
losses = sum(L),
ties = sum(Tie)) %>%
mutate(record = ifelse(ties == 0, paste0(wins,"-",losses),
paste0(wins,"-",losses,"-",ties)))
alt_univ <- cross_join_games %>%
mutate(W = ifelse(points.x > PA,1,0),
L = ifelse(points.x < PA,1,0),
Tie = ifelse(points.x == PA,1,0)) %>%
group_by(owner,year,schedule) %>%
summarise(wins = sum(W),
losses = sum(L),
ties = sum(Tie)) %>%
mutate(record = ifelse(ties == 0, paste0(wins,"-",losses),
paste0(wins,"-",losses,"-",ties)))
View(alt_univ)
alt_univ %>% filter(owner == "Hartman", year == 2016)
# make the plot
plot_data <- alt_univ %>%
filter(year == 2017) %>%
select(owner,schedule,record) %>%
spread(., value = record)
# make the plot
plot_data <- alt_univ %>%
filter(year == 2017) %>%
select(owner,schedule,record) %>%
spread(., value = record, key = schedule)
# make the plot
plot_data <- alt_univ %>%
ungroup() %>%
filter(year == 2017) %>%
select(owner,schedule,record) %>%
spread(., value = record, key = schedule)
# make the plot
plot_data17 <- alt_univ %>%
ungroup() %>%
filter(year == 2017) %>%
select(owner,schedule,record) %>%
spread(., value = record, key = schedule)
View(plot_data17)
print(plot_data17)
alt17 <- alt_univ %>% filter(year == 2017)
plot <- ggplot(data = alt_univ,aes(x=opponent,y=owner,label=record)) +
theme_bw() +
geom_text(aes(size=4)) +
scale_x_discrete("Opponent") +
scale_y_discrete("You", lim=rev(unique(rivalry_data$owner))) +
theme(legend.position = 'none',panel.grid.minor=element_line(colour='white'),
axis.text.x=element_text(angle=45,hjust=1,size=12),
axis.text.y=element_text(size=12))
plot <- ggplot(data = alt_univ,aes(x=opponent,y=owner,label=record)) +
theme_bw() +
geom_text(aes(size=4)) +
scale_x_discrete("Opponent") +
scale_y_discrete("You", lim=rev(unique(alt_univ$owner))) +
theme(legend.position = 'none',panel.grid.minor=element_line(colour='white'),
axis.text.x=element_text(angle=45,hjust=1,size=12),
axis.text.y=element_text(size=12))
print(plot)
plot <- ggplot(data = alt_univ,aes(x=schedule,y=owner,label=record)) +
theme_bw() +
geom_text(aes(size=4)) +
scale_x_discrete("Opponent") +
scale_y_discrete("You", lim=rev(unique(alt_univ$owner))) +
theme(legend.position = 'none',panel.grid.minor=element_line(colour='white'),
axis.text.x=element_text(angle=45,hjust=1,size=12),
axis.text.y=element_text(size=12))
print(plot)
plot <- ggplot(data = alt_univ %>% filter(year == 2017),
aes(x=schedule,y=owner,label=record)) +
theme_bw() +
geom_text(aes(size=4)) +
scale_x_discrete("Opponent") +
scale_y_discrete("You", lim=rev(unique(alt_univ$owner))) +
theme(legend.position = 'none',panel.grid.minor=element_line(colour='white'),
axis.text.x=element_text(angle=45,hjust=1,size=12),
axis.text.y=element_text(size=12))
print(plot)
plot <- ggplot(data = alt_univ %>% filter(year == 2017, owner != "Ready"),
aes(x=schedule,y=owner,label=record)) +
theme_bw() +
geom_text(aes(size=4)) +
scale_x_discrete("Opponent") +
scale_y_discrete("You", lim=rev(unique(alt_univ$owner))) +
theme(legend.position = 'none',panel.grid.minor=element_line(colour='white'),
axis.text.x=element_text(angle=45,hjust=1,size=12),
axis.text.y=element_text(size=12))
print(plot)
plot <- ggplot(data = alt_univ %>% filter(year == 2017, owner != "Ready", schedule != "Ready"),
aes(x=schedule,y=owner,label=record)) +
theme_bw() +
geom_text(aes(size=4)) +
scale_x_discrete("Opponent") +
scale_y_discrete("You", lim=rev(unique(alt_univ$owner))) +
theme(legend.position = 'none',panel.grid.minor=element_line(colour='white'),
axis.text.x=element_text(angle=45,hjust=1,size=12),
axis.text.y=element_text(size=12))
print(plot)
alt17 <- alt_univ %>% filter(year == 2017)
plot <- ggplot(data = alt17,
aes(x=schedule,y=owner,label=record)) +
theme_bw() +
geom_text(aes(size=4)) +
scale_x_discrete("Opponent") +
scale_y_discrete("You", lim=rev(unique(alt_univ$owner))) +
theme(legend.position = 'none',panel.grid.minor=element_line(colour='white'),
axis.text.x=element_text(angle=45,hjust=1,size=12),
axis.text.y=element_text(size=12))
print(plot)
View(alt17)
plot <- ggplot(data = alt17,
aes(x=schedule,y=owner,label=record)) +
theme_bw() +
geom_text(aes(size=4)) +
scale_x_discrete("Opponent") +
scale_y_discrete("You", lim=rev(unique(alt17$owner))) +
theme(legend.position = 'none',panel.grid.minor=element_line(colour='white'),
axis.text.x=element_text(angle=45,hjust=1,size=12),
axis.text.y=element_text(size=12))
print(plot)
plot <- ggplot(data = alt17,
aes(x=schedule,y=owner,label=record)) +
theme_bw() +
geom_text(aes(size=4)) +
scale_x_discrete("Opponent") +
scale_y_discrete("You", lim=rev(unique(alt17$owner))) +
theme(legend.position = 'none',panel.grid.minor=element_line(colour='white'),
axis.text.x=element_text(angle=45,hjust=1,size=12),
axis.text.y=element_text(size=12,angle=90))
print(plot)
plot <- ggplot(data = alt17,
aes(x=schedule,y=owner,label=record)) +
theme_bw() +
geom_text(aes(size=4)) +
scale_x_discrete("Opponent") +
scale_y_discrete("You", lim=rev(unique(alt17$owner))) +
theme(legend.position = 'none',panel.grid.minor=element_line(colour='white'),
axis.text.x=element_text(angle=45,hjust=1,size=12),
axis.text.y=element_text(size=12))
print(plot)
?theme
plot17 <- ggplot(data = alt17,
aes(x=schedule,y=owner,label=record)) +
theme_bw() +
geom_text(aes(size=4)) +
scale_x_discrete("Hypothetical Schedule Rather Than Yours") +
scale_y_discrete("You", lim=rev(unique(alt17$owner))) +
theme(legend.position = 'none',panel.grid.minor=element_line(colour='white'),
axis.text.x=element_text(angle=45,hjust=1,size=12),
axis.text.y=element_text(size=12)) +
ggtitle("Records in Alternate Universes", sub "2017")
plot17 <- ggplot(data = alt17,
aes(x=schedule,y=owner,label=record)) +
theme_bw() +
geom_text(aes(size=4)) +
scale_x_discrete("Hypothetical Schedule Rather Than Yours") +
scale_y_discrete("You", lim=rev(unique(alt17$owner))) +
theme(legend.position = 'none',panel.grid.minor=element_line(colour='white'),
axis.text.x=element_text(angle=45,hjust=1,size=12),
axis.text.y=element_text(size=12)) +
ggtitle("Records in Alternate Universes", sub = "2017")
print(plot7)
plot17 <- ggplot(data = alt17,
aes(x=schedule,y=owner,label=record)) +
theme_bw() +
geom_text(aes(size=4)) +
scale_x_discrete("Hypothetical Schedule Rather Than Yours") +
scale_y_discrete("You", lim=rev(unique(alt17$owner))) +
theme(legend.position = 'none',panel.grid.minor=element_line(colour='white'),
axis.text.x=element_text(angle=45,hjust=1,size=12),
axis.text.y=element_text(size=12)) +
ggtitle("Records in Alternate Universes", sub = "2017")
print(plot17)
alt17 <- alt_univ %>% filter(year == 2017)
plot17 <- ggplot(data = alt17,
aes(x=schedule,y=owner,label=record)) +
theme_bw() +
geom_text(aes(size=4)) +
scale_x_discrete("Hypothetical Schedule Rather Than Yours") +
scale_y_discrete("You", lim=rev(unique(alt17$owner))) +
theme(legend.position = 'none',panel.grid.minor=element_line(colour='white'),
axis.text.x=element_text(angle=45,hjust=1,size=12),
axis.text.y=element_text(size=12)) +
ggtitle("Records in Alternate Universes", sub = "2017 Season")
print(plot17)
actual_records <- alt_univ %>% filter(year == 2017, owner == schedule)
View(actual_records)
max_records <- alt_univ %>%
filter(year == 2017) %>%
group_by(owner,schedule) %>%
summarise(wins = sum(W)) %>%
ungroup() %>%
group_by(owner) %>%
filter(wins == max(wins))
max_records <- alt_univ %>%
filter(year == 2017) %>%
ungroup() %>%
group_by(owner) %>%
filter(wins == max(wins))
View(max_records)
max_records <- alt_univ %>%
filter(year == 2017) %>%
ungroup() %>%
group_by(owner) %>%
filter(wins == max(wins))
min_records <- alt_univ %>%
filter(year == 2017) %>%
ungroup() %>%
group_by(owner) %>%
filter(wins == min(wins))
max_records <- alt_univ %>%
filter(year == 2017) %>%
ungroup() %>%
group_by(owner) %>%
filter(wins == max(wins)) %>%
summarise(total_obs = n()) %>%
mutate(schedule = ifelse(total_obs == 1,schedule,total_obs)) %>%
slice(1)
View(max_records)
max_records <- alt_univ %>%
filter(year == 2017) %>%
ungroup() %>%
group_by(owner) %>%
filter(wins == max(wins)) %>%
mutate(had_you_played = ifelse(n() == 1, schedule, as.character(n())))
View(max_records)
max_records <- alt_univ %>%
max_records <- alt_univ %>%
)
max_records <- alt_univ %>%
filter(year == 2017) %>%
ungroup() %>%
group_by(owner) %>%
filter(wins == max(wins)) %>%
mutate(had_you_played = ifelse(n() == 1, schedule, paste0(as.character(n())," others")))
View(max_records)
max_records <- alt_univ %>%
filter(year == 2017) %>%
ungroup() %>%
group_by(owner) %>%
filter(wins == max(wins)) %>%
mutate(had_you_played_max = ifelse(n() == 1, schedule, paste0(as.character(n())," others")))
min_records <- alt_univ %>%
filter(year == 2017) %>%
ungroup() %>%
group_by(owner) %>%
filter(wins == min(wins)) %>%
mutate(had_you_played_min = ifelse(n() == 1, schedule, paste0(as.character(n())," others")))
all_records <- actual_records %>%
left_join(max_records %>% rename(max_wins = wins) %>% select(owner, max_wins, had_you_played_max), by = "owner") %>%
left_join(min_records %>% rename(min_wins = wins) %>% select(owner, min_wins, had_you_played_min), by = "owner")
View(all_records)
max_records <- alt_univ %>%
filter(year == 2017) %>%
ungroup() %>%
group_by(owner) %>%
filter(wins == max(wins)) %>%
mutate(had_you_played_max = ifelse(n() == 1, schedule, paste0(as.character(n())," others"))) %>%
slice(1)
min_records <- alt_univ %>%
filter(year == 2017) %>%
ungroup() %>%
group_by(owner) %>%
filter(wins == min(wins)) %>%
mutate(had_you_played_min = ifelse(n() == 1, schedule, paste0(as.character(n())," others"))) %>%
slice(1)
all_records <- actual_records %>%
left_join(max_records %>% rename(max_wins = wins) %>% select(owner, max_wins, had_you_played_max), by = "owner") %>%
left_join(min_records %>% rename(min_wins = wins) %>% select(owner, min_wins, had_you_played_min), by = "owner")
View(all_records)
all_records <- actual_records %>%
left_join(max_records %>% rename(max_wins = wins) %>% select(owner, max_wins, had_you_played_max), by = "owner") %>%
left_join(min_records %>% rename(min_wins = wins) %>% select(owner, min_wins, had_you_played_min), by = "owner") %>%
select(owner,wins,max_wins,head_you_played_max,min_wins,had_you_played_min)
all_records <- actual_records %>%
left_join(max_records %>% rename(max_wins = wins) %>% select(owner, max_wins, had_you_played_max), by = "owner") %>%
left_join(min_records %>% rename(min_wins = wins) %>% select(owner, min_wins, had_you_played_min), by = "owner") %>%
select(owner,wins,max_wins,had_you_played_max,min_wins,had_you_played_min)
all_records <- actual_records %>%
ungroup() %>%
left_join(max_records %>% rename(max_wins = wins) %>% select(owner, max_wins, had_you_played_max), by = "owner") %>%
left_join(min_records %>% rename(min_wins = wins) %>% select(owner, min_wins, had_you_played_min), by = "owner") %>%
select(owner,wins,max_wins,had_you_played_max,min_wins,had_you_played_min)
View(all_records)
alt_univ %>%
arrange(desc(wins)) %>%
filter(wins >= 12)
alt_univ %>%
arrange(desc(wins)) %>%
filter(wins >= 12) %>%
select(owner, year, record, schedule)
alt_univ %>%
arrange(desc(wins)) %>%
filter(wins <= 2) %>%
select(owner, year, record, schedule)
alt_univ %>%
arrange(desc(wins)) %>%
filter(wins <= 1) %>%
select(owner, year, record, schedule)
alt_univ %>%
arrange(desc(wins)) %>%
filter(wins <= 2) %>%
select(owner, year, record, schedule)
alt_univ %>%
arrange(desc(wins)) %>%
filter(wins <= 1) %>%
select(owner, year, record, schedule)
